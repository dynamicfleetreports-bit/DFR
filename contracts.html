<!DOCTYPE html>
<html lang="en">
<head>
    <script type="module" src="firebase-helper.js"></script>
    <meta charset="UTF-8">
    <title>SLA | Dynamic Fleet Reporting</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@400;700;900&family=Playfair+Display:italic&display=swap');
        body { font-family: 'Outfit', sans-serif; padding: 40px; background: #f1f5f9; color: #1e293b; line-height: 1.4; }
        .contract-card { background: white; max-width: 900px; margin: 0 auto; padding: 4rem; border-radius: 0.5rem; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }
        .clause-title { font-weight: 900; text-transform: uppercase; font-size: 0.8rem; color: #1e40af; margin-top: 1.5rem; margin-bottom: 0.5rem; border-bottom: 1px solid #f1f5f9; padding-bottom: 2px; }
        .clause-text { font-size: 0.85rem; color: #475569; margin-bottom: 0.75rem; text-align: justify; }
        .signature-font { font-family: 'Playfair Display', serif; }
        @media print { .no-print { display: none; } body { padding: 0; background: white; } .contract-card { box-shadow: none; border: none; width: 100%; padding: 1.5rem; } }
    </style>
</head>
<body>

    <div class="no-print max-w-[900px] mx-auto mb-6 flex justify-between items-center">
        <button onclick="window.history.back()" class="text-[10px] font-black uppercase text-slate-400 hover:text-blue-600 font-bold">← Back</button>
        <div class="flex gap-4">
            <button onclick="window.print()" class="border border-slate-300 px-6 py-2 rounded-full font-black uppercase text-[10px] hover:bg-slate-50 transition font-bold">Print Agreement</button>
            <button onclick="signAgreement()" class="bg-blue-600 text-white px-8 py-2 rounded-full font-black uppercase text-[10px] hover:bg-blue-700 shadow-lg font-bold">Execute & Activate</button>
        </div>
    </div>

    <div class="contract-card">
        <header class="flex justify-between items-start mb-8">
            <div class="flex items-center gap-6">
                <img src="Logo.png" alt="Logo" class="h-20 w-auto">
                <div>
                    <h1 class="text-3xl font-black uppercase italic tracking-tighter leading-none">Master Service <span class="text-blue-600">Agreement</span></h1>
                    <p class="text-[9px] font-bold text-slate-400 tracking-[0.2em] mt-1 uppercase font-black">Dynamic Fleet Reporting</p>
                    <p class="text-[8px] text-slate-500 uppercase font-bold tracking-widest">Moorreesburg, Western Cape</p>
                </div>
            </div>
            <div class="text-right p-3 bg-slate-50 rounded border border-slate-100">
                <p class="text-[8px] font-black text-slate-400 uppercase">Document Ref</p>
                <p id="docRef" class="text-xs font-bold text-slate-800 font-mono">DFR-SLA-2026-X</p>
            </div>
        </header>

        <h3 class="clause-title">1. THE PARTIES</h3>
        <p class="clause-text">
            This Agreement is entered into on <span class="font-bold underline" id="currentDate">--</span> by and between <strong>Dynamic Fleet Reporting</strong>, Moorreesburg (the "Consultant") and <span id="clientName" class="font-bold underline uppercase">[Client Name]</span> (the "Subscriber").
        </p>

        <h3 class="clause-title">2. SCOPE OF SERVICES</h3>
        <p class="clause-text">The Consultant shall provide managed intelligence to reduce the <strong>Efficiency Gap</strong>. Deliverables include: Weekly Fuel Reconciliation, Consumption Target Tracking, Siphoning/Theft Alerts, Driver Risk Profiles, and On-Demand Custom Data Deep-Dives.</p>

        <h3 class="clause-title">3. FINANCIAL TERMS & PAY STRUCTURE</h3>
        <div class="grid grid-cols-2 gap-4 mb-4">
            <div class="bg-slate-50 p-4 rounded border border-slate-100 text-xs">
                <p><strong>3.1 Implementation:</strong> R 2,500.00 (Once-off)</p>
                <p><strong>3.2 Management Base:</strong> R 1,500.00 (Monthly)</p>
                <p><strong>3.3 Monitoring Fee:</strong> R 200.00 per vehicle (Monthly)</p>
            </div>
            <div id="priceSection" class="bg-blue-50 p-4 rounded border border-blue-100 flex flex-col justify-center">
                </div>
        </div>
        <p class="clause-text text-[10px]">Invoices issued on the 25th of the month. Payment due within 7 days. All fees exclude VAT.</p>

        <h3 class="clause-title">4. DATA SUPPLY & OBLIGATIONS</h3>
        <p class="clause-text italic text-blue-700 font-bold">Accuracy is contingent upon the Subscriber fulfilling the following:</p>
        <ul class="list-disc ml-6 text-[13px] text-slate-600 mb-4 space-y-1">
            <li><strong>Automated Channel:</strong> Telematics reports must be CC'd to: <br><strong id="clientSpecificEmail" class="text-slate-900 underline">dynamicfleetreports+[client]@gmail.com</strong></li>
            <li><strong>Fuel Data:</strong> Submission of fuel liters filled per unit every <strong>Friday by 16:00</strong>.</li>
            <li><strong>Odometer Data:</strong> Submission of manual odometer readings every <strong>Monday by 09:00</strong>.</li>
        </ul>

        <h3 class="clause-title">5. GENERAL TERMS & CONDITIONS</h3>
        <p class="clause-text">
            <strong>5.1 Duration:</strong> This Agreement is month-to-month.
            <br><strong>5.2 Cancellation:</strong> Either party may terminate with <strong>30 (thirty) days written notice</strong>.
            <br><strong>5.3 Confidentiality:</strong> Consultant shall maintain strict confidentiality of Subscriber data and not disclose it to third parties.
            <br><strong>5.4 Limitation of Liability:</strong> Consultant provides analytical insights and is not liable for actual fuel theft, mechanical failure, or driver conduct.
            <br><strong>5.5 Breach:</strong> In the event of non-payment or failure to provide data, Consultant reserves the right to suspend services immediately.
            <br><strong>5.6 Governing Law:</strong> This agreement is governed by the laws of the Republic of South Africa.
        </p>

        <div class="mt-12 pt-6 border-t-2 border-slate-900 grid grid-cols-2 gap-10">
            <div>
                <p class="text-[9px] font-black text-slate-400 uppercase mb-6 tracking-widest">For: Dynamic Fleet Reporting</p>
                <div class="h-10 flex items-end"><p class="signature-font text-2xl text-blue-800 italic">Dynamic Fleet Reporting</p></div>
                <div class="border-t border-slate-200 mt-2"><p class="text-[9px] font-bold text-slate-500 uppercase">Authorized Officer</p></div>
            </div>
            <div>
                <p class="text-[9px] font-black text-slate-400 uppercase mb-6 tracking-widest text-blue-500">For: The Subscriber</p>
                <div id="signBox" class="h-10 flex items-end cursor-pointer group" onclick="signAgreement()">
                    <p id="signText" class="text-slate-300 italic text-xs group-hover:text-blue-500 font-bold underline transition-all">CLICK HERE TO SIGN</p>
                </div>
                <div class="border-t border-slate-200 mt-2"><p id="signDate" class="text-[9px] font-bold text-slate-400 uppercase italic">Awaiting Acceptance</p></div>
            </div>
        </div>
        
        <footer class="mt-10 text-center border-t border-slate-50 pt-4">
            <p class="text-[8px] text-slate-400 uppercase tracking-[0.2em]">Moorreesburg, Western Cape | dynamicfleetreports@gmail.com</p>
        </footer>
    </div>

    <script>
        window.onload = async () => {
            const data = JSON.parse(await cloudStorage.getItem('AUDIT_FINAL'));
            const now = new Date();
            document.getElementById('currentDate').innerText = now.toLocaleDateString('en-ZA', { day: 'numeric', month: 'long', year: 'numeric' });
            document.getElementById('docRef').innerText = `DFR-SLA-${now.getFullYear()}-${Math.floor(1000 + Math.random() * 9000)}`;

            if (data && data.client) {
                document.getElementById('clientName').innerText = data.client.company;
                const cleanName = data.client.company.toLowerCase().replace(/[^a-z0-9]/g, '');
                document.getElementById('clientSpecificEmail').innerText = `dynamicfleetreports+${cleanName}@gmail.com`;

                const fSize = data.client.fleetSize || 5;
                const setup = 2500;
                const monthly = 1500 + (fSize * 200);

                document.getElementById('priceSection').innerHTML = `
                    <div class="flex justify-between text-[10px] font-black text-blue-700 uppercase"><span>First Month (Inc. Setup)</span><span>R ${(setup + monthly).toLocaleString()}</span></div>
                    <div class="flex justify-between text-base font-black text-slate-900 border-t border-blue-100 mt-1 pt-1"><span>Monthly Retainer</span><span>R ${monthly.toLocaleString()}</span></div>
                `;
            }
        };

        async function signAgreement() {
            const data = JSON.parse(await cloudStorage.getItem('AUDIT_FINAL'));
            document.getElementById('signText').innerHTML = `<span class="signature-font text-3xl text-blue-600 italic">${data ? data.client.contactName : 'Authorized Signatory'}</span>`;
            document.getElementById('signDate').innerHTML = `<span class="text-emerald-600 font-black">✓ EXECUTED: ${new Date().toLocaleString()}</span>`;
            
            let clients = JSON.parse(await cloudStorage.getItem('FLEET_CLIENTS')) || [];
            const idx = clients.findIndex(c => c.id === data.client.id);
            if(idx !== -1) { clients[idx].status = 'active'; await cloudStorage.setItem('FLEET_CLIENTS', JSON.stringify(clients)); }
            alert("Contract Executed Successfully.");
        }
    </script>
</body>

</html>
